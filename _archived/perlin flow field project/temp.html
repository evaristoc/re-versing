12 let shaderMaterial = new THREE.ShaderMaterial( {
13    uniforms:       uniforms,
14    vertexShader:   shaders.vertex,
15    fragmentShader: shaders.fragment,
16    //blending:       THREE.AdditiveBlending,
17    depthTest:      false,
18    transparent:    true,
19    vertexColors:   true
20 });


<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
   2
   3
   4
   5
   6
   7</pre></td><td><pre style="margin: 0; line-height: 95%"><span style="color: #66d9ef">const</span> <span style="color: #a6e22e">shaders</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #a6e22e">fragment</span><span style="color: #f92672">:</span> <span style="color: #960050; background-color: #1e0010">`</span>
   
               <span style="color: #a6e22e">$</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Noise3D</span><span style="color: #f8f8f2">}</span>
   
       <span style="color: #960050; background-color: #1e0010">`</span><span style="color: #f8f8f2">,</span>
   <span style="color: #f8f8f2">}</span>
   </pre></td></tr></table></div>
   

<!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">  193
  194
  195
  196
  197
  198
  199
  200
  201
  202
  203
  204
  205
  206
  207
  208
  209
  210
  211</pre></td><td><pre style="margin: 0; line-height: 95%">            
            <span style="color: #6ab825; font-weight: bold">uniform</span> <span style="color: #6ab825">vec2</span> <span style="color: #d0d0d0">resolution;</span>
            <span style="color: #6ab825; font-weight: bold">uniform</span> <span style="color: #6ab825">float</span> <span style="color: #d0d0d0">time;</span>
  
            <span style="color: #a6e22e">$</span><span style="color: #f8f8f2">{</span><span style="color: #a6e22e">Noise3D</span><span style="color: #f8f8f2">}</span>
  
            <span style="color: #6ab825; font-weight: bold">void</span> <span style="color: #447fcf">main</span><span style="color: #d0d0d0">()</span> <span style="color: #d0d0d0">{</span>
               <span style="color: #6ab825">float</span> <span style="color: #d0d0d0">speed</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">16.</span><span style="color: #d0d0d0">;</span>
               <span style="color: #6ab825">float</span> <span style="color: #d0d0d0">scale</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">3.5</span><span style="color: #d0d0d0">;</span>
   
               <span style="color: #6ab825">vec2</span> <span style="color: #d0d0d0">st</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">gl_FragCoord.xy/resolution.xy;</span>
               <span style="color: #d0d0d0">st.x</span> <span style="color: #d0d0d0">*=</span> <span style="color: #d0d0d0">resolution.x/resolution.y;</span>
               <span style="color: #d0d0d0">st</span> <span style="color: #d0d0d0">*=</span> <span style="color: #d0d0d0">scale;</span>

               <span style="color: #6ab825">float</span> <span style="color: #d0d0d0">noise</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">snoise(vec3(st.x,</span> <span style="color: #d0d0d0">st.y,</span> <span style="color: #d0d0d0">time</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">speed</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">0.01</span><span style="color: #d0d0d0">));</span>
               <span style="color: #6ab825">float</span> <span style="color: #d0d0d0">c</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(noise</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">1.</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">/</span> <span style="color: #3677a9">2.</span><span style="color: #d0d0d0">;</span>

               <span style="color: #d0d0d0">gl_FragColor</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec4(c,</span> <span style="color: #d0d0d0">c,</span> <span style="color: #d0d0d0">c,</span> <span style="color: #3677a9">1.</span><span style="color: #d0d0d0">);</span>
            <span style="color: #d0d0d0">}</span>
  </pre></td></tr></table></div>
  






<!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">
   86
   87
   88
   89
   90
   91
   92
   93
   94
   95
   96
   97
   98
   99
  100
  101
  102
  103
  104
  105
  106
  107
  108
  109
  110
  111
  112
  113
  114
  115
  116
  117
  118
  119
  120
  121
  122
  123
  124
  125
  126
  127
  128
  129
  130
  131
  132
  133
  134
  135
  136
  137
  138
  139
  140
  141
  142
  143
  144
  145
  146
  147
  148
  149
  150
  151
  152
  153
  154
  155
  156
  157
  158
  159
  160
  161
  162
  163
  164
  165
  166
  167
  168
  169
  170
  171
  172
  173
  174
  175
  176
  177
  178
  179
  180
  181
  182
  183
  184
  185
  186
  187
</pre></td><td><pre style="margin: 0; line-height: 125%">
  <span style="color: #999999; font-style: italic">//</span>
  <span style="color: #999999; font-style: italic">// Description : Array and textureless GLSL 2D/3D/4D simplex </span>
  <span style="color: #999999; font-style: italic">//               noise functions.</span>
  <span style="color: #999999; font-style: italic">//      Author : Ian McEwan, Ashima Arts.</span>
  <span style="color: #999999; font-style: italic">//  Maintainer : stegu</span>
  <span style="color: #999999; font-style: italic">//     Lastmod : 20110822 (ijm)</span>
  <span style="color: #999999; font-style: italic">//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.</span>
  <span style="color: #999999; font-style: italic">//               Distributed under the MIT License. See LICENSE file.</span>
  <span style="color: #999999; font-style: italic">//               https://github.com/ashima/webgl-noise</span>
  <span style="color: #999999; font-style: italic">//               https://github.com/stegu/webgl-noise</span>
  <span style="color: #999999; font-style: italic">// </span>
  
  <span style="color: #6ab825;">vec3</span> <span style="color: #447fcf">mod289</span><span style="color: #d0d0d0">(vec3</span> <span style="color: #d0d0d0">x)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">floor(x</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">(</span><span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">/</span> <span style="color: #3677a9">289.0</span><span style="color: #d0d0d0">))</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">289.0</span><span style="color: #d0d0d0">;</span>
  <span style="color: #d0d0d0">}</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #447fcf">mod289</span><span style="color: #d0d0d0">(vec4</span> <span style="color: #d0d0d0">x)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">floor(x</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">(</span><span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">/</span> <span style="color: #3677a9">289.0</span><span style="color: #d0d0d0">))</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">289.0</span><span style="color: #d0d0d0">;</span>
  <span style="color: #d0d0d0">}</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #447fcf">permute</span><span style="color: #d0d0d0">(vec4</span> <span style="color: #d0d0d0">x)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">mod289(((x*</span><span style="color: #3677a9">34.0</span><span style="color: #d0d0d0">)+</span><span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">)*x);</span>
  <span style="color: #d0d0d0">}</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #447fcf">taylorInvSqrt</span><span style="color: #d0d0d0">(vec4</span> <span style="color: #d0d0d0">r)</span>
  <span style="color: #d0d0d0">{</span>
  <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #3677a9">1.79284291400159</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">0.85373472095314</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">r;</span>
  <span style="color: #d0d0d0">}</span>
  
  <span style="color: #6ab825;">float</span> <span style="color: #447fcf">snoise</span><span style="color: #d0d0d0">(vec3</span> <span style="color: #d0d0d0">v)</span>
  <span style="color: #d0d0d0">{</span> 
  <span style="color: #6ab825; font-weight: bold">const</span> <span style="color: #6ab825;">vec2</span>  <span style="color: #d0d0d0">C</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec2(</span><span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">/</span><span style="color: #3677a9">6.0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">/</span><span style="color: #3677a9">3.0</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">;</span>
  <span style="color: #6ab825; font-weight: bold">const</span> <span style="color: #6ab825;">vec4</span>  <span style="color: #d0d0d0">D</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec4(</span><span style="color: #3677a9">0.0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0.5</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2.0</span><span style="color: #d0d0d0">);</span>
  
  <span style="color: #999999; font-style: italic">// First corner</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">i</span>  <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">floor(v</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dot(v,</span> <span style="color: #d0d0d0">C.yyy)</span> <span style="color: #d0d0d0">);</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">x0</span> <span style="color: #d0d0d0">=</span>   <span style="color: #d0d0d0">v</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">i</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dot(i,</span> <span style="color: #d0d0d0">C.xxx)</span> <span style="color: #d0d0d0">;</span>
  
  <span style="color: #999999; font-style: italic">// Other corners</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">g</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">step(x0.yzx,</span> <span style="color: #d0d0d0">x0.xyz);</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">l</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">g;</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">i1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">min(</span> <span style="color: #d0d0d0">g.xyz,</span> <span style="color: #d0d0d0">l.zxy</span> <span style="color: #d0d0d0">);</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">i2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">max(</span> <span style="color: #d0d0d0">g.xyz,</span> <span style="color: #d0d0d0">l.zxy</span> <span style="color: #d0d0d0">);</span>
  
  <span style="color: #999999; font-style: italic">//   x0 = x0 - 0.0 + 0.0 * C.xxx;</span>
  <span style="color: #999999; font-style: italic">//   x1 = x0 - i1  + 1.0 * C.xxx;</span>
  <span style="color: #999999; font-style: italic">//   x2 = x0 - i2  + 2.0 * C.xxx;</span>
  <span style="color: #999999; font-style: italic">//   x3 = x0 - 1.0 + 3.0 * C.xxx;</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">x1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">x0</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">i1</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">C.xxx;</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">x2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">x0</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">i2</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">C.yyy;</span> <span style="color: #999999; font-style: italic">// 2.0*C.x = 1/3 = C.y</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">x3</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">x0</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">D.yyy;</span>      <span style="color: #999999; font-style: italic">// -1.0+3.0*C.x = -0.5 = -D.y</span>
  
  <span style="color: #999999; font-style: italic">// Permutations</span>
  <span style="color: #d0d0d0">i</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">mod289(i);</span> 
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">p</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">permute(</span> <span style="color: #d0d0d0">permute(</span> <span style="color: #d0d0d0">permute(</span> 
  <span style="color: #d0d0d0">i.z</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">vec4(</span><span style="color: #3677a9">0.0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">i1.z,</span> <span style="color: #d0d0d0">i2.z,</span> <span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">))</span>
  <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">i.y</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">vec4(</span><span style="color: #3677a9">0.0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">i1.y,</span> <span style="color: #d0d0d0">i2.y,</span> <span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">))</span> 
  <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">i.x</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">vec4(</span><span style="color: #3677a9">0.0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">i1.x,</span> <span style="color: #d0d0d0">i2.x,</span> <span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">));</span>
  
  <span style="color: #999999; font-style: italic">// Gradients: 7x7 points over a square, mapped onto an octahedron.</span>
  <span style="color: #999999; font-style: italic">// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)</span>
  <span style="color: #6ab825;">float</span> <span style="color: #d0d0d0">n_</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.142857142857</span><span style="color: #d0d0d0">;</span> <span style="color: #999999; font-style: italic">// 1.0/7.0</span>
  <span style="color: #6ab825;">vec3</span>  <span style="color: #d0d0d0">ns</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">n_</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">D.wyz</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">D.xzx;</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">j</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">p</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">49.0</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">floor(p</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">ns.z</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">ns.z);</span>  <span style="color: #999999; font-style: italic">//  mod(p,7*7)</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">x_</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">floor(j</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">ns.z);</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">y_</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">floor(j</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">7.0</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">x_</span> <span style="color: #d0d0d0">);</span>    <span style="color: #999999; font-style: italic">// mod(j,N)</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">x_</span> <span style="color: #d0d0d0">*ns.x</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">ns.yyyy;</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">y_</span> <span style="color: #d0d0d0">*ns.x</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">ns.yyyy;</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">abs(x)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">abs(y);</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">b0</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec4(</span> <span style="color: #d0d0d0">x.xy,</span> <span style="color: #d0d0d0">y.xy</span> <span style="color: #d0d0d0">);</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">b1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec4(</span> <span style="color: #d0d0d0">x.zw,</span> <span style="color: #d0d0d0">y.zw</span> <span style="color: #d0d0d0">);</span>
  
  <span style="color: #999999; font-style: italic">//vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;</span>
  <span style="color: #999999; font-style: italic">//vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">s0</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">floor(b0)*</span><span style="color: #3677a9">2.0</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">;</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">s1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">floor(b1)*</span><span style="color: #3677a9">2.0</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">;</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">sh</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">-step(h,</span> <span style="color: #d0d0d0">vec4(</span><span style="color: #3677a9">0.0</span><span style="color: #d0d0d0">));</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">a0</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">b0.xzyw</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">s0.xzyw*sh.xxyy</span> <span style="color: #d0d0d0">;</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">a1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">b1.xzyw</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">s1.xzyw*sh.zzww</span> <span style="color: #d0d0d0">;</span>
  
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">p0</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec3(a0.xy,h.x);</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">p1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec3(a0.zw,h.y);</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">p2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec3(a1.xy,h.z);</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">p3</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec3(a1.zw,h.w);</span>
  
  <span style="color: #999999; font-style: italic">//Normalise gradients</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">norm</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">taylorInvSqrt(vec4(dot(p0,p0),</span> <span style="color: #d0d0d0">dot(p1,p1),</span> <span style="color: #d0d0d0">dot(p2,</span> <span style="color: #d0d0d0">p2),</span> <span style="color: #d0d0d0">dot(p3,p3)));</span>
  <span style="color: #d0d0d0">p0</span> <span style="color: #d0d0d0">*=</span> <span style="color: #d0d0d0">norm.x;</span>
  <span style="color: #d0d0d0">p1</span> <span style="color: #d0d0d0">*=</span> <span style="color: #d0d0d0">norm.y;</span>
  <span style="color: #d0d0d0">p2</span> <span style="color: #d0d0d0">*=</span> <span style="color: #d0d0d0">norm.z;</span>
  <span style="color: #d0d0d0">p3</span> <span style="color: #d0d0d0">*=</span> <span style="color: #d0d0d0">norm.w;</span>
  
  <span style="color: #999999; font-style: italic">// Mix final noise value</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">m</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">max(</span><span style="color: #3677a9">0.6</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">vec4(dot(x0,x0),</span> <span style="color: #d0d0d0">dot(x1,x1),</span> <span style="color: #d0d0d0">dot(x2,x2),</span> <span style="color: #d0d0d0">dot(x3,x3)),</span> <span style="color: #3677a9">0.0</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">m</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">m</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">m;</span>
  <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #3677a9">42.0</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">dot(</span> <span style="color: #d0d0d0">m*m,</span> <span style="color: #d0d0d0">vec4(</span> <span style="color: #d0d0d0">dot(p0,x0),</span> <span style="color: #d0d0d0">dot(p1,x1),</span> 
  <span style="color: #d0d0d0">dot(p2,x2),</span> <span style="color: #d0d0d0">dot(p3,x3)</span> <span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">}</span>
</pre></td></tr></table></div>

<!-- HTML generated using hilite.me -->
<div style="background: #202020; overflow:auto; width:auto; padding:.2em .2em;"><table style="border: #202020;" ><tr style="border: #202020;"><td style="border: #202020;"><pre style="border: #202020; background: #202020; margin: 0; line-height: 95%">

   86
   87
   88
   89
   90
   91
   92
   93
   94
   95
   96
   97
   98
   99
  100
  101
  102
  103
  104
  105
  106
  107
  108
  109
  110
  111
  112
  113
  114
  115
  116
  117
  118
  119
  120
  121
  122
  123
  124
  125
  126
  127
  128
  129
  130
  131
  132
  133
  134
  135
  136
  137
  138
  139
  140
  141
  142
  143
  144
  145
  146
  147
  148
  149
  150
  151
  152
  153
  154
  155
  156
  157
  158
  159
  160
  161
  162
  163
  164
  165
  166
  167
  168
  169
  170
  171
  172
  173
  174
  175
  176
  177
  178
  179
  180
  181
  182
  183
  184
  185
  186
  187
</pre></td><td style="border: #202020;"><pre style="border: #202020; background: #202020; margin: 0; line-height: 95%">
  <span style="color: #999999; font-style: italic">//</span>
  <span style="color: #999999; font-style: italic">// Description : Array and textureless GLSL 2D/3D/4D simplex </span>
  <span style="color: #999999; font-style: italic">//               noise functions.</span>
  <span style="color: #999999; font-style: italic">//      Author : Ian McEwan, Ashima Arts.</span>
  <span style="color: #999999; font-style: italic">//  Maintainer : stegu</span>
  <span style="color: #999999; font-style: italic">//     Lastmod : 20110822 (ijm)</span>
  <span style="color: #999999; font-style: italic">//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.</span>
  <span style="color: #999999; font-style: italic">//               Distributed under the MIT License. See LICENSE file.</span>
  <span style="color: #999999; font-style: italic">//               https://github.com/ashima/webgl-noise</span>
  <span style="color: #999999; font-style: italic">//               https://github.com/stegu/webgl-noise</span>
  <span style="color: #999999; font-style: italic">// </span>
  
  <span style="color: #6ab825;">vec3</span> <span style="color: #447fcf">mod289</span><span style="color: #d0d0d0">(vec3</span> <span style="color: #d0d0d0">x)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">floor(x</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">(</span><span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">/</span> <span style="color: #3677a9">289.0</span><span style="color: #d0d0d0">))</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">289.0</span><span style="color: #d0d0d0">;</span>
  <span style="color: #d0d0d0">}</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #447fcf">mod289</span><span style="color: #d0d0d0">(vec4</span> <span style="color: #d0d0d0">x)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">floor(x</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">(</span><span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">/</span> <span style="color: #3677a9">289.0</span><span style="color: #d0d0d0">))</span> <span style="color: #d0d0d0">*</span> <span style="color: #3677a9">289.0</span><span style="color: #d0d0d0">;</span>
  <span style="color: #d0d0d0">}</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #447fcf">permute</span><span style="color: #d0d0d0">(vec4</span> <span style="color: #d0d0d0">x)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">mod289(((x*</span><span style="color: #3677a9">34.0</span><span style="color: #d0d0d0">)+</span><span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">)*x);</span>
  <span style="color: #d0d0d0">}</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #447fcf">taylorInvSqrt</span><span style="color: #d0d0d0">(vec4</span> <span style="color: #d0d0d0">r)</span>
  <span style="color: #d0d0d0">{</span>
  <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #3677a9">1.79284291400159</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">0.85373472095314</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">r;</span>
  <span style="color: #d0d0d0">}</span>
  
  <span style="color: #6ab825;">float</span> <span style="color: #447fcf">snoise</span><span style="color: #d0d0d0">(vec3</span> <span style="color: #d0d0d0">v)</span>
  <span style="color: #d0d0d0">{</span> 
  <span style="color: #6ab825; font-weight: bold">const</span> <span style="color: #6ab825;">vec2</span>  <span style="color: #d0d0d0">C</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec2(</span><span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">/</span><span style="color: #3677a9">6.0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">/</span><span style="color: #3677a9">3.0</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">;</span>
  <span style="color: #6ab825; font-weight: bold">const</span> <span style="color: #6ab825;">vec4</span>  <span style="color: #d0d0d0">D</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec4(</span><span style="color: #3677a9">0.0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0.5</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">2.0</span><span style="color: #d0d0d0">);</span>
  
  <span style="color: #999999; font-style: italic">// First corner</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">i</span>  <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">floor(v</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dot(v,</span> <span style="color: #d0d0d0">C.yyy)</span> <span style="color: #d0d0d0">);</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">x0</span> <span style="color: #d0d0d0">=</span>   <span style="color: #d0d0d0">v</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">i</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dot(i,</span> <span style="color: #d0d0d0">C.xxx)</span> <span style="color: #d0d0d0">;</span>
  
  <span style="color: #999999; font-style: italic">// Other corners</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">g</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">step(x0.yzx,</span> <span style="color: #d0d0d0">x0.xyz);</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">l</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">g;</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">i1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">min(</span> <span style="color: #d0d0d0">g.xyz,</span> <span style="color: #d0d0d0">l.zxy</span> <span style="color: #d0d0d0">);</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">i2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">max(</span> <span style="color: #d0d0d0">g.xyz,</span> <span style="color: #d0d0d0">l.zxy</span> <span style="color: #d0d0d0">);</span>
  
  <span style="color: #999999; font-style: italic">//   x0 = x0 - 0.0 + 0.0 * C.xxx;</span>
  <span style="color: #999999; font-style: italic">//   x1 = x0 - i1  + 1.0 * C.xxx;</span>
  <span style="color: #999999; font-style: italic">//   x2 = x0 - i2  + 2.0 * C.xxx;</span>
  <span style="color: #999999; font-style: italic">//   x3 = x0 - 1.0 + 3.0 * C.xxx;</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">x1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">x0</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">i1</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">C.xxx;</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">x2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">x0</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">i2</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">C.yyy;</span> <span style="color: #999999; font-style: italic">// 2.0*C.x = 1/3 = C.y</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">x3</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">x0</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">D.yyy;</span>      <span style="color: #999999; font-style: italic">// -1.0+3.0*C.x = -0.5 = -D.y</span>
  
  <span style="color: #999999; font-style: italic">// Permutations</span>
  <span style="color: #d0d0d0">i</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">mod289(i);</span> 
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">p</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">permute(</span> <span style="color: #d0d0d0">permute(</span> <span style="color: #d0d0d0">permute(</span> 
  <span style="color: #d0d0d0">i.z</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">vec4(</span><span style="color: #3677a9">0.0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">i1.z,</span> <span style="color: #d0d0d0">i2.z,</span> <span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">))</span>
  <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">i.y</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">vec4(</span><span style="color: #3677a9">0.0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">i1.y,</span> <span style="color: #d0d0d0">i2.y,</span> <span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">))</span> 
  <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">i.x</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">vec4(</span><span style="color: #3677a9">0.0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">i1.x,</span> <span style="color: #d0d0d0">i2.x,</span> <span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">));</span>
  
  <span style="color: #999999; font-style: italic">// Gradients: 7x7 points over a square, mapped onto an octahedron.</span>
  <span style="color: #999999; font-style: italic">// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)</span>
  <span style="color: #6ab825;">float</span> <span style="color: #d0d0d0">n_</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.142857142857</span><span style="color: #d0d0d0">;</span> <span style="color: #999999; font-style: italic">// 1.0/7.0</span>
  <span style="color: #6ab825;">vec3</span>  <span style="color: #d0d0d0">ns</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">n_</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">D.wyz</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">D.xzx;</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">j</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">p</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">49.0</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">floor(p</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">ns.z</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">ns.z);</span>  <span style="color: #999999; font-style: italic">//  mod(p,7*7)</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">x_</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">floor(j</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">ns.z);</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">y_</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">floor(j</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">7.0</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">x_</span> <span style="color: #d0d0d0">);</span>    <span style="color: #999999; font-style: italic">// mod(j,N)</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">x</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">x_</span> <span style="color: #d0d0d0">*ns.x</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">ns.yyyy;</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">y</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">y_</span> <span style="color: #d0d0d0">*ns.x</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">ns.yyyy;</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">h</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1.0</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">abs(x)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">abs(y);</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">b0</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec4(</span> <span style="color: #d0d0d0">x.xy,</span> <span style="color: #d0d0d0">y.xy</span> <span style="color: #d0d0d0">);</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">b1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec4(</span> <span style="color: #d0d0d0">x.zw,</span> <span style="color: #d0d0d0">y.zw</span> <span style="color: #d0d0d0">);</span>
  
  <span style="color: #999999; font-style: italic">//vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;</span>
  <span style="color: #999999; font-style: italic">//vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">s0</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">floor(b0)*</span><span style="color: #3677a9">2.0</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">;</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">s1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">floor(b1)*</span><span style="color: #3677a9">2.0</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">;</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">sh</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">-step(h,</span> <span style="color: #d0d0d0">vec4(</span><span style="color: #3677a9">0.0</span><span style="color: #d0d0d0">));</span>
  
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">a0</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">b0.xzyw</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">s0.xzyw*sh.xxyy</span> <span style="color: #d0d0d0">;</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">a1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">b1.xzyw</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">s1.xzyw*sh.zzww</span> <span style="color: #d0d0d0">;</span>
  
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">p0</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec3(a0.xy,h.x);</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">p1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec3(a0.zw,h.y);</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">p2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec3(a1.xy,h.z);</span>
  <span style="color: #6ab825;">vec3</span> <span style="color: #d0d0d0">p3</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">vec3(a1.zw,h.w);</span>
  
  <span style="color: #999999; font-style: italic">//Normalise gradients</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">norm</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">taylorInvSqrt(vec4(dot(p0,p0),</span> <span style="color: #d0d0d0">dot(p1,p1),</span> <span style="color: #d0d0d0">dot(p2,</span> <span style="color: #d0d0d0">p2),</span> <span style="color: #d0d0d0">dot(p3,p3)));</span>
  <span style="color: #d0d0d0">p0</span> <span style="color: #d0d0d0">*=</span> <span style="color: #d0d0d0">norm.x;</span>
  <span style="color: #d0d0d0">p1</span> <span style="color: #d0d0d0">*=</span> <span style="color: #d0d0d0">norm.y;</span>
  <span style="color: #d0d0d0">p2</span> <span style="color: #d0d0d0">*=</span> <span style="color: #d0d0d0">norm.z;</span>
  <span style="color: #d0d0d0">p3</span> <span style="color: #d0d0d0">*=</span> <span style="color: #d0d0d0">norm.w;</span>
  
  <span style="color: #999999; font-style: italic">// Mix final noise value</span>
  <span style="color: #6ab825;">vec4</span> <span style="color: #d0d0d0">m</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">max(</span><span style="color: #3677a9">0.6</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">vec4(dot(x0,x0),</span> <span style="color: #d0d0d0">dot(x1,x1),</span> <span style="color: #d0d0d0">dot(x2,x2),</span> <span style="color: #d0d0d0">dot(x3,x3)),</span> <span style="color: #3677a9">0.0</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">m</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">m</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">m;</span>
  <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #3677a9">42.0</span> <span style="color: #d0d0d0">*</span> <span style="color: #d0d0d0">dot(</span> <span style="color: #d0d0d0">m*m,</span> <span style="color: #d0d0d0">vec4(</span> <span style="color: #d0d0d0">dot(p0,x0),</span> <span style="color: #d0d0d0">dot(p1,x1),</span> 
  <span style="color: #d0d0d0">dot(p2,x2),</span> <span style="color: #d0d0d0">dot(p3,x3)</span> <span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">}</span>
</pre></td></tr></table></div>
  